<!doctype html>
<html lang="en">
 
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      AndreyMelnikov.MyBlog &middot;    # мой блог: IT-марафон.
    
  </title>

  <link rel="stylesheet" href="/styles.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-precomposed.ico" type="image/vnd.microsoft.icon">
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?">
  <link rel="alternate" type="application/atom+xml" title="AndreyMelnikov.MyBlog" href="/atom.xml">


  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Home" />
<meta name="author" content="Andrey Melnikov" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/page3/" />
<meta property="og:url" content="http://localhost:4000/page3/" />
<meta property="og:site_name" content="AndreyMelnikov.MyBlog" />
<link rel="prev" href="http://localhost:4000/page2" />
<link rel="next" href="http://localhost:4000/page4" />
<script type="application/ld+json">
{"headline":"Home","@type":"WebPage","url":"http://localhost:4000/page3/","author":{"@type":"Person","name":"Andrey Melnikov"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body>
	<table>
	<p></p>
	</table>
    <div class="container content">
	
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">AndreyMelnikov.MyBlog</a>
          <small>   # мой блог: IT-марафон.</small>
        </h3>
		<p><img src="/image/my_avatar.jpeg"</p>
      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2021/03/25/programming-universe6/">
        Вселенная программирования. Ключевые концепции ч3 - Параллелизм.
      </a>
    </h1>

    <time datetime="2021-03-25T00:00:00+03:00" class="post-date">25 Mar 2021</time>

    <p><img src="/image/post-2021-01-10/1.png" alt="" /></p>

<p>Продолжаю развивать начатую тему <a href="https://optima740.github.io/2020/12/25/programming-universe1/"><strong>вселенная программирования</strong></a>, описываю свое понимание основных концепций программирования. В этой статье я опишу следующую (начало главы <a href="https://optima740.github.io/2021/02/02/programming-universe4/">тут</a>) ключевую концепцию программирования – <strong>параллелизм</strong>.<br />
Ранее я уже немножко затрагивал тему синхронного и асинхронного программирования вот в этой своей <a href="https://optima740.github.io/2020/11/11/imperativ_programm_function-call/">статье</a>. Но в тот раз это было очень-очень поверхностно, в рамках понимания совсем другой темы. Сегодня мы поговорим о параллелизме более подробно и концептуально.</p>

<p><em>Параллелизм</em> - <strong>независимое и потенциально одновременное выполнение инструкций</strong>. Программа конструируется из независимых частей, которые, в свою очередь, могут быть исполнены в любом порядке и это не приведет к проблеме коллизии.<br />
Когда мы говорим о параллелизме, стоит сразу сделать оговорку. Параллелизм – как концепция независимого, одновременного выполнения, применительно к программированию, не совсем подходит. Потому, что независимые части кода могут выполняться условно одновременно на единственном процессоре, используя механизм разделения времени между процессами.<br />
Ну, например, в языке Python (по крайней мере в его версиях на момент написания статьи) нет, как таковой, поддержки многопоточности (параллелизма) именно самим языком. Но есть много фреймворков и библиотек, которые эту возможность предоставляют, например, модуль <strong><code class="highlighter-rouge">threading</code></strong> или <strong><code class="highlighter-rouge">acyncio</code></strong>.<br />
Однако, не стоит забывать, что интерпретатор языка - CPython использует GIL (<em>Global Interpreter Lock</em>). Суть GIL заключается в том, что выполнять байт код может только один поток. Это нужно для того, чтобы упростить работу с памятью (на уровне интерпретатора). В этой ситуации, условно, все задачи которые программист хочет решить при помощи параллельных вычислений можно разделить на две большие группы:</p>

<ul>
  <li>
    <p><strong>CPU-bound</strong>  (те, что преимущественно используют процессор для своего выполнения, например, математические) – в данном случае необходимо использовать модуль <strong><code class="highlighter-rouge">multiprocessing</code></strong>. Этот модуль использует весь потенциал всех ядер в процессоре.</p>
  </li>
  <li>
    <p><strong>IO-bound</strong> (задачи, работающие с вводом-выводом: диск, сеть и т.п.) для повышения производительности в данном классе задач, необходимо использовать модули <strong><code class="highlighter-rouge">threading</code></strong> или <strong><code class="highlighter-rouge">acyncio</code></strong>.</p>
  </li>
</ul>

<p>А вот параллелизм, применительно к аппаратному понятию, более точен к своему определению. Мы имеем именно одновременность выполнения. Одна программа может выполняться параллельно на мультипроцессорной системе (засчёт автоматического программно-аппаратного распараллеливания). Опять же, пример с Python, но с использованием модуля многопроцессорной обработки <strong><code class="highlighter-rouge">multiprocessing</code></strong>. В данном случае, мы получаем настоящее параллельное выполнение потоков и, как результат, линейное увеличение скорости вычислений от количества ядер процессора.</p>

<p>Существуют две основные парадигмы внутри концепции параллелизма:</p>
<ul>
  <li><strong>параллелизм с разделяемым состоянием</strong>.</li>
  <li><strong>параллелизм с обменом сообщениями</strong>.</li>
</ul>

<p>При <em>параллелизме с разделяемыми состоянием</em> мы имеем дело с понятиями <strong>мониторов</strong> и <strong>транзакций</strong>.<br />
<em>Мониторы</em> – специальные контролирующие структуры, через которые параллельные потоки получают доступ к общим данным.<br />
<em>Транзакции</em> – операции, при которых потоки выполняют обновление общих структур данных. Но в это время доступ других потоков к этим данным блокируется.<br />
Эта парадигма очень популярна и реализована во всех массовых языках, например, Java и C#.</p>

<p>В <em>параллелизме с обменом сообщениями</em> потоки работают параллельно и обмениваются друг с другом <strong>сообщениями</strong>. Процесс обмена может быть, как синхронным (отправитель ждет подтверждения от получателя), так и асинхронным (отправитель не ждет подтверждения от получателя).<br />
Подобная схема поддерживается, например, в языке Erlang.</p>

<p>На практике существуют несколько видов параллелизма:</p>
<ul>
  <li>
    <p><strong>Распределенная система</strong>. Набор компьютеров, объединенных сетью (например, структура интернета). Тут каждая независимая параллельная активность – это отдельный компьютер.</p>
  </li>
  <li>
    <p><strong>Процессы</strong>. Каждая независимая параллельная активность – это процесс. Используют независимые области памяти. ОС занимается связью прикладных программ, ресурсов, процессов и памяти. Например, обычной программе, как правило, выделяется один процесс, внутри которого она выполняется.</p>
  </li>
  <li>
    <p><strong>Потоки (нити)</strong>. Каждая независимая параллельная активность – это поток (или нить) - <em>thread</em>. Потоки выполняются независимо, однако используют общую область памяти. Например, закладки внутри браузера (активности внутри одной родительской программы, выполняющейся внутри одного процесса) обычно работают в разных потоках.</p>
  </li>
</ul>

<p>Таким образом, главное отличие процессов от потоков заключается в управлении ресурсами.</p>

<p>Процессы – это <em>конкуренция</em> (каждый процесс пытается захватить под себя ресурсы). 
Потоки - это <em>кооперация</em> (Потоки внутри процесса, делят ресурсы и действуют совместно, для того чтобы процесс показал наилучший результат)</p>

<p>Но давайте остановимся на понятии <strong>потока</strong> более подробно.<br />
В современном программировании часто требуется, чтобы программа содержала несколько самостоятельных активностей, каждая из которых выполняется в своём темпе. Между активностями не должно быть никаких взаимных помех. Они исполняются абсолютно независимо друг от друга, если только программист не решит каким-то явным и корректным образом организовать их взаимодействие.<br />
Как я уже сказал, поток - это обычный последовательно выполняющийся код.<br />
После введения концепции одновременной работы программе допускается поддерживать более чем один поток, каждый из которых работает одновременно с другими потоками, и в то же время полностью независим от других потоков.</p>

<p>Ниже пример кода Python с использованием многопоточности (модуль <strong><code class="highlighter-rouge">threading</code></strong>).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Thread</span>

<span class="k">class</span> <span class="nc">MyThread</span><span class="p">(</span><span class="n">Thread</span><span class="p">):</span>
    <span class="c1"># создаем свой класс – наследник от класса Thread модуля threading
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c1"># инициализация потока
</span>        <span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># переопределяем метод запуска потока
</span>        <span class="n">amount</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">"</span><span class="si">%</span><span class="s">s is running"</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="k">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">create_threads</span><span class="p">():</span>
    <span class="c1"># создаем группу потоков
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">"Thread #</span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">my_thread</span> <span class="o">=</span> <span class="n">MyThread</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">my_thread</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">create_threads</span><span class="p">()</span>
</code></pre></div></div>

<p>После запуска данного кода мы получим следующее:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Thread</span> <span class="c1">#2 is running
</span><span class="n">Thread</span> <span class="c1">#3 is running
</span><span class="n">Thread</span> <span class="c1">#1 is running
</span><span class="n">Thread</span> <span class="c1">#4 is running
</span><span class="n">Thread</span> <span class="c1">#5 is running
</span></code></pre></div></div>
<p>Причем, скорее всего, каждый раз потоки будут отработаны в случайном порядке. Почему так происходит? Потому что механизм распараллеливания выполняет код из соображений эффективности. Программисту при написании прикладного кода правильнее всего полагать, что все повторения тела цикла выполняются одновременно. Иначе возникают проблема, называемая обычно проблемой <strong>race conditions</strong>.<br />
Более детально о данной проблеме и из каких причин она вытекает мы поговорим в следующей части Вселенной программирования.</p>


  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page4">Предыдущий</a>
  
  
    <a class="pagination-item newer" href="/page2">Следующий</a>
  
</div>


<aside class="related">
  <h3>История постов</h3>
  <ul class="related-posts">
    
      <li>
        <a href="/2021/04/09/programming-universe8/">
          Вселенная программирования. Ключевые концепции ч5 - Абстракция данных.
          <small><time datetime="2021-04-09T00:00:00+03:00">09 Apr 2021</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2021/04/05/programming-universe7/">
          Вселенная программирования. Ключевые концепции ч4 - Темная сторона параллелизма.
          <small><time datetime="2021-04-05T00:00:00+03:00">05 Apr 2021</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2021/03/25/programming-universe6/">
          Вселенная программирования. Ключевые концепции ч3 - Параллелизм.
          <small><time datetime="2021-03-25T00:00:00+03:00">25 Mar 2021</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2021/02/15/programming-universe5/">
          Вселенная программирования. Ключевые концепции ч2 - Замыкания.
          <small><time datetime="2021-02-15T00:00:00+03:00">15 Feb 2021</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2021/02/02/programming-universe4/">
          Вселенная программирования. Ключевые концепции ч1.
          <small><time datetime="2021-02-02T00:00:00+03:00">02 Feb 2021</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2021/01/26/programming-universe3/">
          Вселенная программирования. Вычислительные модели – основные характеристики.
          <small><time datetime="2021-01-26T00:00:00+03:00">26 Jan 2021</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2021/01/10/programming-universe2/">
          Вселенная программирования. Глобальный взгляд на проектирование.
          <small><time datetime="2021-01-10T00:00:00+03:00">10 Jan 2021</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/12/25/programming-universe1/">
          Вселенная программирования. Введение.
          <small><time datetime="2020-12-25T00:00:00+03:00">25 Dec 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/11/15/imperativ_programm_function-call2/">
          Императивное программирование. Вызов функций ч2.
          <small><time datetime="2020-11-15T00:00:00+03:00">15 Nov 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/11/11/imperativ_programm_function-call/">
          Императивное программирование. Вызов функций, нити исполнения кода.
          <small><time datetime="2020-11-11T00:00:00+03:00">11 Nov 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/09/18/TG-bot-heroku-deploy/">
          Питонячий Телеграм-Бот, Yandex-API и диплой на Heroku.
          <small><time datetime="2020-09-18T00:00:00+03:00">18 Sep 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/07/28/FP-base-structs/">
          Функциональное программирование. Элементарные конструкции.
          <small><time datetime="2020-07-28T00:00:00+03:00">28 Jul 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/07/04/Functional-programming/">
          Функциональное программирование. Другой взгляд на мир.
          <small><time datetime="2020-07-04T00:00:00+03:00">04 Jul 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/06/14/Django-button_admin/">
          Django. Своя кнопка в админке.
          <small><time datetime="2020-06-14T00:00:00+03:00">14 Jun 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/05/28/Django-timezone/">
          Django. Время поговорить о времени.
          <small><time datetime="2020-05-28T00:00:00+03:00">28 May 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/05/08/Django-commands_and_pagination-%D0%BA%D0%BE%D0%BF%D0%B8%D1%8F/">
          Django. Пользовательские команды и Пагинация.
          <small><time datetime="2020-05-08T00:00:00+03:00">08 May 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/04/20/Django-scrf/">
          Django. Немного о SCRF.
          <small><time datetime="2020-04-20T00:00:00+03:00">20 Apr 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/04/15/Django-authorization/">
          Django. Авторизация и ограничение доступа.
          <small><time datetime="2020-04-15T00:00:00+03:00">15 Apr 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/04/13/Django-create-rest-api/">
          Django. Быстро прикручиваем REST API к проекту.
          <small><time datetime="2020-04-13T00:00:00+03:00">13 Apr 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/04/12/Django-REST/">
          Django. Знакомство с REST.
          <small><time datetime="2020-04-12T00:00:00+03:00">12 Apr 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/04/01/Django-stop-control/">
          Django. Стоп, контроль!
          <small><time datetime="2020-04-01T00:00:00+03:00">01 Apr 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/03/25/Django/">
          Django, приятно познакомиться.
          <small><time datetime="2020-03-25T00:00:00+03:00">25 Mar 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/02/17/go-to-stage-down/">
          Идем в машинное отделение.
          <small><time datetime="2020-02-17T00:00:00+03:00">17 Feb 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2020/01/23/start-point/">
          Точка старта. Когда ты понимаешь, что твои знания равны нулю)
          <small><time datetime="2020-01-23T00:00:00+03:00">23 Jan 2020</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2019/12/26/blog-building/">
          Pages.GitHub и Jekyll
          <small><time datetime="2019-12-26T00:00:00+03:00">26 Dec 2019</time></small>
        </a>
      </li>
    
      <li>
        <a href="/2019/12/25/my_first_steps/">
          Мой Блог. Начало.
          <small><time datetime="2019-12-25T00:00:00+03:00">25 Dec 2019</time></small>
        </a>
      </li>
    
  </ul>
</aside>



      </main>
	  
	
  

      <footer class="footer">
        <small><font style="color: gray; font-size: 16px; font-family: Arial">
		  <p><a href = 'https://vk.com/amelnikofcode'><font style="color: gray; font-size: 16px; font-family: Arial"> Мой профиль в ВК </font></a></p>
		  <p><a href = 'https://github.com/optima740'><font style="color: gray; font-size: 16px; font-family: Arial"> Мой профиль на GitHub</font></a></p>
		  &copy; <time datetime="2021-04-10T12:54:03+03:00">2021</time>
		</font>  
		  
        </small>
      </footer>
    </div>

    
  </body>
</html>
